<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.monthly.mapper.AdminMapper">

    <select id="findAll" resultType="sellerDto">
        SELECT SELLER_NUMBER, SELLER_NAME, SELLER_STATUS,SELLER_ID,SELLER_PHONE_NUMBER,SELLER_REGISTER_DATE,SELLER_COMPANY_REGISTER_NUMBER,SELLER_EMAIL,SELLER_ADDRESS
        FROM MONTHLY_SELLER
        WHERE SELLER_NUMBER=#{sellerNumber},SELLER_NAME = #{sellerName},SELLER_ID=#{sellerId}
    </select>

<!--    관리자 로그인-->
    <select id="findAdminNumber" resultType="long" >
        SELECT ADMIN_NUMBER
        FROM MONTHLY_ADMIN
        WHERE ADMIN_ID =#{adminId} and ADMIN_PASSWORD=#{adminPassword}
    </select>

    <select id="sellerApplication" resultType="adminChartVo">
        SELECT TO_CHAR(b.dt, 'YYYY-MM') AS SELLER_REGISTER_DATE
        , NVL(SUM(a.REGISTRATION_COUNT), 0) REGISTRATION_COUNT
        FROM ( SELECT TO_CHAR(SELLER_REGISTER_DATE, 'YYYY-MM-DD') AS SELLER_REGISTER_DATE
        , COUNT(*) REGISTRATION_COUNT
        FROM MONTHLY_SELLER
        WHERE SELLER_REGISTER_DATE BETWEEN TO_DATE('2023-01-01', 'YYYY-MM-DD')
        AND TO_DATE('2023-12-31', 'YYYY-MM-DD')
        GROUP BY SELLER_REGISTER_DATE
        ) a
        , ( SELECT TO_DATE('2023-01-01','YYYY-MM-DD') + LEVEL - 1 AS dt
        FROM dual
        <![CDATA[
            CONNECT BY LEVEL <= (TO_DATE('2023-12-31','YYYY-MM-DD') - TO_DATE('2023-01-01','YYYY-MM-DD') + 1)
             ]]>
        ) b
        WHERE b.dt = a.SELLER_REGISTER_DATE(+)
        GROUP BY TO_CHAR(b.dt, 'YYYY-MM')
        ORDER BY TO_CHAR(b.dt, 'YYYY-MM')
    </select>

    <select id="paymentCount" resultType="adminChartVo">
        SELECT TO_CHAR(b.dt, 'YYYY-MM') AS PAYMENT_DATE,
        NVL(SUM(a.PAYMENT_PRICE), 0) AS PAYMENT_PRICE_COUNT
        FROM (
        SELECT TO_CHAR(PAYMENT_DATE, 'YYYY-MM') AS PAYMENT_DATE,
        PAYMENT_PRICE,
        PAYMENT_STATUS
        FROM MONTHLY_PAYMENT
        WHERE PAYMENT_STATUS = 1
        AND PAYMENT_DATE BETWEEN TO_DATE('2023-01-01', 'YYYY-MM-DD') AND TO_DATE('2023-12-31', 'YYYY-MM-DD')
        ) a
        RIGHT JOIN (
        SELECT TO_DATE('2023-' || LPAD(LEVEL, 2, '0'), 'YYYY-MM') AS dt
        FROM dual
        <![CDATA[
            CONNECT BY LEVEL <= 12
              ]]>
        ) b ON TO_CHAR(b.dt, 'YYYY-MM') = a.PAYMENT_DATE
        GROUP BY TO_CHAR(b.dt, 'YYYY-MM')
        ORDER BY TO_CHAR(b.dt, 'YYYY-MM')
    </select>





</mapper>








<!--        <if test="searchType != null and searchValue != '' ">-->
<!--        &lt;!&ndash;화면에서 보낸 데이터가 text를 비우고 보내면 빈 문자열을 보낸다. value는 ''를 해주면 아무것도 안쓰고 검색시 원하는대로 검색이 가능하다.&ndash;&gt;-->
<!--        <bind name="sV" value=" '%' + searchValue '%'   "/>-->
<!--        &lt;!&ndash;get방식으로 보낼 땐 parameterType으로 전달해주는 값이 없으므로 if문 안에 bind를 넣어주면 오류가 안난다.&ndash;&gt;-->
<!--        WHERE ${searchType} like #{sV}-->
<!--        </if>-->
